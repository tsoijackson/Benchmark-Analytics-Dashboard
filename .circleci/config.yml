# Use the latest 2.1 version of CircleCI pipeline processing engine, see https://circleci.com/docs/2.0/configuration-reference/
version: 2.1

# Use a package of configuration called an orb, see https://circleci.com/docs/2.0/orb-intro/
orbs:
  # Declare a dependency on the welcome-orb
  welcome: circleci/welcome-orb@0.3.1

# Orchestrate or schedule a set of jobs, see https://circleci.com/docs/2.0/workflows/
workflows:
  # Name the workflow "Welcome"
  Welcome:
    # Run the welcome/run job in its own container
    jobs:
      - welcome/run

      build: # runs not using Workflows must have a `build` job as entry point
        working_directory: ~/app # directory where steps will run
        docker: # run the steps with Docker
          - image: circleci/node:9.9 # image as the primary container; this is where all `steps` will run
        steps: # a collection of executable commands
          - checkout # special step to check out source code to working directory

          - run:
              name: npm-update
              command: 'sudo npm install -g npm@latest'

          - restore_cache: # special step to restore the dependency cache
              key: dependency-cache-{{ checksum "backend/package.json" }}

          - run:
              name: npm-install
              command: npm install

          - save_cache: # special step to save the dependency cache
              key: dependency-cache-{{ checksum "backend/package.json" }}
              paths:
                - ./node_modules